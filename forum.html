<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Forum - SPECTRUM.BYTE</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" type="image/png" href="img/ico.png" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            display: ['Inter', 'sans-serif'],
          },
          screens: {
            xs: '480px',
          }
        }
      }
    }
  </script>
  <style>
    body {
      background: linear-gradient(135deg, #0b1120 0%, #131e33 100%);
      color: white;
      min-height: 100vh;
    }
    .glow-text {
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }
    @keyframes bounce-slow {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    .animate-bounce-slow {
      animation: bounce-slow 3s infinite;
    }
    .fade-in {
      animation: fadeIn 0.6s ease-out forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="font-sans">

  <!-- ===== NAVBAR ATAS ===== -->
<nav class="fixed top-0 left-0 right-0 z-[9999] bg-black/80 backdrop-blur-sm border-b border-cyan-500/20 px-4 py-2 flex items-center justify-between">
  <!-- Kiri: Logo + Nama Brand -->
  <div class="flex items-center gap-2">
      <a href="index.html">
        <img src="img/Logo.png" alt="Spectrum.Byte" class="w-7 h-7 rounded-full border border-cyan-400 shadow-[0_0_8px_rgba(0,255,255,0.4)]">
      </a>
      <a href="index.html" class="text-base font-bold text-transparent bg-gradient-to-r from-cyan-400 to-fuchsia-500 bg-clip-text">Home</a>
    </div>

  <!-- Kanan: Toggle Bahasa + Tombol Forum -->
  <div class="flex items-center gap-2">
    <!-- Toggle Bahasa -->
    <div class="flex items-center gap-1">
      <button onclick="setLang('id')" id="btnId" 
              class="px-2.5 py-1 text-xs font-medium rounded-md bg-cyan-500/20 text-cyan-300 border border-cyan-500/30">ID</button>
      <button onclick="setLang('en')" id="btnEn" 
              class="px-2.5 py-1 text-xs font-medium rounded-md text-gray-400 hover:text-gray-200">ENG</button>
    </div>

    <!-- Tombol Forum (aktif di halaman ini, tapi tetap bisa klik) -->
    <!-- a href="chatbot.html" 
       class="ml-2 bg-[rgba(0,234,255,0.15)] border border-[rgba(0,234,255,0.3)] text-white px-3 py-1.5 rounded-lg text-xs sm:text-sm transition uppercase tracking-wide no-underline flex items-center gap-1">
      Spectrum.Ai
    </a>
  </div -->
</nav>

  <!-- ===== KONTEN FORUM ===== -->
  <main class="pt-20 pb-12 px-4 max-w-3xl mx-auto">
    <div class="text-center mb-8">
      <h1 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-cyan-400 to-fuchsia-500 text-transparent bg-clip-text">Forum Kritik & Saran</h1>
      <p class="text-gray-400 mt-2 text-sm">Bagi kami setiap masukan sangat berharga!</p>
    </div>

    <!-- Form Kirim Komentar -->
    <div class="bg-[rgba(13,20,35,0.7)] rounded-xl p-5 border border-cyan-500/20 mb-8">
      <textarea id="mainMessage" rows="3"
                class="w-full p-3 rounded-lg bg-gray-800 text-white text-sm border border-gray-600 focus:outline-none focus:ring-1 focus:ring-cyan-400"
                placeholder="Tulis kritik, saran, atau pengalaman Anda..."></textarea>
      <div class="mt-3 flex justify-end">
        <button onclick="postComment()"
                class="px-5 py-2 bg-cyan-500 hover:bg-cyan-400 text-black font-medium rounded-lg transition uppercase tracking-wide text-sm">
          Kirim
        </button>
      </div>
    </div>

    <!-- Daftar Komentar -->
    <div id="commentsContainer" class="space-y-5">
      <!-- Komentar akan muncul di sini -->
    </div>
  </main>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
 <script>
    // Inisialisasi Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDxBWbzttv2gaPVrphK-0WcaAOY1dbTxiQ",
        authDomain: "forumdb-358d4.firebaseapp.com",
        databaseURL: "https://forumdb-358d4-default-rtdb.asia-southeast1.firebasedatabase.app/",
        projectId: "forumdb-358d4",
        appId: "1:690140074859:web:767450f11d2f122177722e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const commentsRef = db.ref('comments');

    // --- Konfigurasi Khusus Admin ---
    const ADMIN_USERNAME = "Admin_Spectrum"; // Ganti dengan username khusus Anda
    const ADMIN_TOKEN = "SpectrumByte_Admin_Access_9f3b1a_Xyz789"; // Ganti dengan token khusus Anda
    // --------------------------------

    // Fungsi untuk membuat ID unik sederhana
    function generateId() {
        return Math.random().toString(36).substr(2, 9);
    }

    // Ambil token akses komentar dari localStorage (jika ada)
    function getStoredCommentToken() {
        // Cek apakah token admin disimpan di localStorage
        if (localStorage.getItem('forum_comment_token') === ADMIN_TOKEN) {
            return ADMIN_TOKEN; // Jika cocok, gunakan token admin
        }
        // Jika tidak, kembalikan token biasa
        return localStorage.getItem('forum_comment_token');
    }

    // Simpan token akses komentar ke localStorage
    function setStoredCommentToken(token) {
        localStorage.setItem('forum_comment_token', token);
    }

    // Ambil token saat halaman dimuat
    let currentCommentToken = getStoredCommentToken();

    // Fungsi untuk menampilkan modal konfirmasi kustom
    function showCustomConfirm(message, onConfirm, onCancel = () => {}) {
        const modal = document.getElementById('customConfirmModal');
        const messageEl = document.getElementById('customConfirmMessage');
        const okBtn = document.getElementById('customConfirmOK');
        const cancelBtn = document.getElementById('customConfirmCancel');

        // Set pesan
        messageEl.textContent = message;

        // Hapus event listener sebelumnya untuk mencegah penumpukan
        okBtn.onclick = null;
        cancelBtn.onclick = null;

        // Atur handler untuk tombol OK
        okBtn.onclick = function() {
            modal.classList.remove('animate-fade-in-up');
            modal.classList.add('animate-fade-out-down');
            setTimeout(() => {
                modal.classList.add('hidden');
                onConfirm(); // Panggil callback jika pengguna menekan OK
            }, 300);
        };

        // Atur handler untuk tombol Cancel
        cancelBtn.onclick = function() {
            modal.classList.remove('animate-fade-in-up');
            modal.classList.add('animate-fade-out-down');
            setTimeout(() => {
                modal.classList.add('hidden');
                onCancel(); // Panggil callback jika pengguna menekan Batal
            }, 300);
        };

        // Tampilkan modal
        modal.classList.remove('hidden');
        modal.classList.remove('animate-fade-out-down');
        modal.classList.add('animate-fade-in-up');
    }

    // Hapus komentar dari Firebase
    function deleteComment(commentId) {
        showCustomConfirm(
            "Apakah Anda yakin ingin menghapus komentar ini?",
            () => { // Callback jika OK
                commentsRef.child(commentId).remove()
                    .then(() => {
                        console.log("Komentar berhasil dihapus.");
                        // renderComments akan dipanggil otomatis oleh listener
                    })
                    .catch(error => {
                        console.error("Gagal menghapus komentar: ", error);
                        alert("Gagal menghapus komentar.");
                    });
            },
            () => { // Callback jika Batal (opsional)
                console.log("Penghapusan dibatalkan.");
            }
        );
    }

    // Render komentar dari Firebase
    function renderComments(snapshot) {
        const container = document.getElementById('commentsContainer');
        const comments = [];
        snapshot.forEach(child => {
            comments.push({ id: child.key, ...child.val() });
        });

        // Urutkan: terbaru di atas
        const sorted = comments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        container.innerHTML = '';

        if (sorted.length === 0) {
            container.innerHTML = `<div class="text-center py-10"><p class="text-gray-500 italic">Belum ada komentar. Jadilah yang pertama!</p></div>`;
            return;
        }

        sorted.forEach(comment => {
            const el = document.createElement('div');
            el.className = 'bg-[rgba(10,18,30,0.6)] p-5 rounded-xl border border-[rgba(0,234,255,0.1)]';

            const timestamp = comment.timestamp ? new Date(comment.timestamp).toLocaleString('id-ID') : 'Tidak ada waktu';

            // Periksa apakah komentar ini milik pengguna saat ini (termasuk admin)
            const isOwner = comment.ownerToken === currentCommentToken;

            // --- Periksa apakah ini komentar dari Admin ---
            // Gunakan nama admin jika ownerToken cocok dengan ADMIN_TOKEN
            // Gunakan nama dari data komentar (jika ada) atau 'Anonim' untuk yang lain
            const displayAuthor = comment.ownerToken === ADMIN_TOKEN ? ADMIN_USERNAME : (comment.author || 'Anonim');
            // ------------------------------------------------

            // Render balasan (replies)
            let repliesHtml = '';
            if (comment.replies && Object.keys(comment.replies).length > 0) {
                repliesHtml = `<div class="mt-4 pl-4 border-l-2 border-gray-700 space-y-3">`;
                Object.entries(comment.replies).forEach(([replyId, replyData]) => {
                    const replyTimestamp = replyData.timestamp ? new Date(replyData.timestamp).toLocaleString('id-ID') : 'Tidak ada waktu';
                    // Tampilkan author reply, bisa admin atau anonim
                    const displayReplyAuthor = replyData.ownerToken === ADMIN_TOKEN ? ADMIN_USERNAME : (replyData.author || 'Anonim');
                    repliesHtml += `
                        <div class="bg-[rgba(5,12,22,0.5)] p-3 rounded-lg">
                            <div class="flex justify-between">
                                <span class="text-sm text-purple-300">Balasan dari ${displayReplyAuthor}</span>
                                <span class="text-gray-500 text-xs">${replyTimestamp}</span>
                            </div>
                            <p class="text-gray-300 text-sm mt-1">${replyData.text || ''}</p>
                        </div>
                    `;
                });
                repliesHtml += `</div>`;
            }

            // Struktur HTML untuk tombol hapus
            el.innerHTML = `
                <div class="flex justify-between items-start">
                    <div>
                        <span class="font-semibold text-cyan-300">${displayAuthor}</span>
                        <span class="text-gray-500 text-xs ml-2">${timestamp}</span>
                    </div>
                    ${isOwner ? `<button onclick="deleteComment('${comment.id}')" 
                                    class="text-red-400 hover:text-red-300 text-xs flex items-center gap-1 ml-2 focus:outline-none focus:ring-1 focus:ring-red-400 rounded">üóëÔ∏è Hapus</button>` : ''}
                </div>
                <p class="text-gray-200 mt-3 whitespace-pre-wrap">${comment.text || ''}</p>

                <div class="mt-3">
                    <span class="text-sm text-gray-400">‚ù§Ô∏è ${comment.likes || 0}</span>
                </div>

                <div class="mt-4 flex gap-2">
                    <input type="text" id="reply-${comment.id}" 
                           placeholder="Balas komentar ini..." 
                           class="flex-1 p-2 text-sm rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-1 focus:ring-cyan-400">
                    <button onclick="postReply('${comment.id}')" 
                            class="px-3 py-1.5 bg-purple-600 hover:bg-purple-500 text-white rounded text-sm whitespace-nowrap">
                        Balas
                    </button>
                </div>

                ${repliesHtml}
            `;
            container.appendChild(el);
        });
    }

    // Kirim komentar ke Firebase
    function postComment() {
        const text = document.getElementById('mainMessage').value.trim();
        if (!text) {
            alert('Mohon isi pesan Anda.');
            return;
        }

        // Jika belum ada token, buat token baru (bisa token biasa atau admin)
        if (!currentCommentToken) {
            // --- Cek apakah token admin diset di localStorage secara manual ---
            const storedToken = localStorage.getItem('forum_comment_token');
            if (storedToken === ADMIN_TOKEN) {
                 currentCommentToken = ADMIN_TOKEN;
            } else {
                 currentCommentToken = generateId();
                 setStoredCommentToken(currentCommentToken);
            }
            // --------------------------------------------------------------
        }

        // Gunakan username admin jika token cocok, atau kosongkan untuk anonim
        const author = currentCommentToken === ADMIN_TOKEN ? ADMIN_USERNAME : undefined; // Gunakan undefined atau kosongkan

        commentsRef.push({
            // author: author, // Kita bisa mengirim author jika ingin, atau tidak mengirimnya untuk anonim
            text: text,
            timestamp: firebase.database.ServerValue.TIMESTAMP,
            likes: 0,
            ownerToken: currentCommentToken // Simpan token yang digunakan untuk kepemilikan
        });

        document.getElementById('mainMessage').value = '';
    }

    // Kirim balasan ke Firebase (nested di bawah komentar)
    function postReply(commentId) {
        const input = document.getElementById(`reply-${commentId}`);
        const text = input.value.trim();
        if (!text) return;

        // Gunakan token yang aktif saat ini untuk reply
        const replyOwnerToken = currentCommentToken;
        // Gunakan username admin jika token cocok, atau kosongkan untuk anonim
        const replyAuthor = currentCommentToken === ADMIN_TOKEN ? ADMIN_USERNAME : undefined;

        const replyData = {
            // author: replyAuthor, // Sama seperti komentar utama
            text: text,
            timestamp: firebase.database.ServerValue.TIMESTAMP,
            ownerToken: replyOwnerToken // Simpan token di reply juga
        };

        const newReplyRef = commentsRef.child(commentId).child('replies').push();
        newReplyRef.set(replyData).then(() => {
            input.value = '';
        }).catch(error => {
            console.error("Gagal mengirim balasan: ", error);
            alert("Gagal mengirim balasan.");
        });
    }

    // Fungsi untuk toggle bahasa
    function setLang(lang) {
        const btnId = document.getElementById('btnId');
        const btnEn = document.getElementById('btnEn');
        if (lang === 'id') {
            btnId.className = 'px-2.5 py-1 text-xs font-medium rounded-md bg-cyan-500/20 text-cyan-300 border border-cyan-500/30';
            btnEn.className = 'px-2.5 py-1 text-xs font-medium rounded-md text-gray-400 hover:text-gray-200';
        } else {
            btnId.className = 'px-2.5 py-1 text-xs font-medium rounded-md text-gray-400 hover:text-gray-200';
            btnEn.className = 'px-2.5 py-1 text-xs font-medium rounded-md bg-cyan-500/20 text-cyan-300 border border-cyan-500/30';
        }
    }

    // Dengarkan perubahan real-time dari Firebase
    commentsRef.on('value', renderComments);

    // Set nama pengguna saat halaman dimuat
    window.addEventListener('DOMContentLoaded', (event) => {
        // Karena kita tidak punya input nama, kita bisa sembunyikan elemen input nama jika ada
        const usernameInputDiv = document.getElementById('usernameInputDiv');
        if (usernameInputDiv) {
            usernameInputDiv.style.display = 'none';
        }
    });

    // Ekspor fungsi ke window agar bisa dipanggil oleh onclick di HTML
    window.postComment = postComment;
    window.postReply = postReply;
    window.deleteComment = deleteComment;
    window.setLang = setLang;
</script>

  <style>
  /* Background Angkasa Gelap */
  body {
    background: #000;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #fff;
    position: relative;
  }

  /* Efek Neural Biru Mengambang */
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 30% 30%, rgba(0, 10, 40, 0.8) 0%, rgba(0, 0, 0, 1) 70%);
    z-index: -2;
  }

    /* Jaringan Neural - Titik-titik & Garis */
  .neural-network {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    overflow: hidden;
    pointer-events: none;
  }

  canvas {
    display: block;
    width: 100%;
    height: 100%;
  }
</style>

<div class="neural-network">
  <canvas id="neuralCanvas"></canvas>
</div>

<script>
  // ===== Efek Neural Network Biru =====
  const canvas = document.getElementById("neuralCanvas");
  const ctx = canvas.getContext("2d");

  let particles = [];
  const numParticles = 60;

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();

  for (let i = 0; i < numParticles; i++) {
    particles.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      vx: (Math.random() - 0.5) * 0.6,
      vy: (Math.random() - 0.5) * 0.6,
    });
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "rgba(0, 255, 255, 0.7)";

    particles.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
      ctx.fill();
    });

    for (let i = 0; i < numParticles; i++) {
      for (let j = i + 1; j < numParticles; j++) {
        const dx = particles[i].x - particles[j].x;
        const dy = particles[i].y - particles[j].y;
        const dist = Math.sqrt(dx * dx + dy * dy);

        if (dist < 120) {
          ctx.strokeStyle = `rgba(0, 255, 255, ${1 - dist / 120})`;
          ctx.lineWidth = 0.5;
          ctx.beginPath();
          ctx.moveTo(particles[i].x, particles[i].y);
          ctx.lineTo(particles[j].x, particles[j].y);
          ctx.stroke();
        }
      }
    }

    particles.forEach(p => {
      p.x += p.vx;
      p.y += p.vy;

      if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
      if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
    });

    requestAnimationFrame(draw);
  }

  draw();
</script>
</body>
</html>


