<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Forum - SPECTRUM.BYTE</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="    https://cdn.tailwindcss.com    "></script>
  <link rel="icon" type="image/png" href="img/ico.png" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            display: ['Inter', 'sans-serif'],
          },
          screens: {
            xs: '480px',
          }
        }
      }
    }
  </script>
  <style>
    body {
      background: linear-gradient(135deg, #0b1120 0%, #131e33 100%);
      color: white;
      min-height: 100vh;
    }
    .glow-text {
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }
    @keyframes bounce-slow {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    .animate-bounce-slow {
      animation: bounce-slow 3s infinite;
    }
    .fade-in {
      animation: fadeIn 0.6s ease-out forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="font-sans">
  <!-- ===== HALAMAN LOGIN ===== -->
<div id="loginPage" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999]">
    <div class="bg-[rgba(13,20,35,0.8)] rounded-xl p-8 border border-cyan-500/30 max-w-md w-full mx-4 shadow-2xl animate-fade-in-up">
      <div class="text-center mb-6">
        <h2 class="text-xl font-bold text-transparent bg-gradient-to-r from-cyan-400 to-fuchsia-500 bg-clip-text">Login ke Forum</h2>
      </div>
      <div class="space-y-4">
        <!-- Tombol Login Google yang diperbarui -->
        <button id="googleLoginBtn"
                class="w-full px-5 py-2 bg-red-600 hover:bg-red-500 text-white font-medium rounded-lg transition uppercase tracking-wide text-sm flex items-center justify-center gap-2 group">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="group-hover:scale-110 transition-transform">
            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.25 1.12-1.03 2.13-2.21 2.75V21h3.75c2.18-1.76 3.56-4.5 3.56-7.5z" fill="#4285F4"/>
            <path d="M12 21c1.17 0 2.21-.36 3.06-1.01l-3.06-3.06V12h-3.75v4.26c-.85.65-1.89 1.01-3.06 1.01z" fill="#34A853"/>
            <path d="M5.94 12.25c-.78 0-1.53.07-2.25.2v3.75h4.26c.65-.85 1.01-1.89 1.01-3.06z" fill="#FBBC05"/>
            <path d="M12 5.25c1.17 0 2.21.36 3.06 1.01L12 9.32V12H8.25V8.25c0-1.17.36-2.21 1.01-3.06z" fill="#EA4335"/>
          </svg>
          LOGIN WITH GOOGLE
        </button>
      </div>
      <!-- Hapus elemen "Belum punya akun?" karena tidak diperlukan -->
    </div>
  </div>
  
  <!-- ===== NAVBAR ATAS ===== -->
  <nav id="mainNav" class="fixed top-0 left-0 right-0 z-[9999] bg-black/80 backdrop-blur-sm border-b border-cyan-500/20 px-4 py-2 flex items-center justify-between">
    <!-- Kiri: Logo + Nama Brand -->
    <div class="flex items-center gap-2">
      <a href="index.html">
        <img src="img/Logo.png" alt="Spectrum.Byte" class="w-7 h-7 rounded-full border border-cyan-400 shadow-[0_0_8px_rgba(0,255,255,0.4)]">
      </a>
      <a href="index.html" id="navHomeLink" class="text-base font-bold text-transparent bg-gradient-to-r from-cyan-400 to-fuchsia-500 bg-clip-text">Home</a>
    </div>
    <!-- Tengah: Menu Kategori -->
    <div class="flex space-x-4 items-center">
      <button onclick="switchCategory('kritik')" id="menuKritik"
              class="px-3 py-1 text-sm font-medium rounded-md text-gray-400 hover:text-gray-200">Kritik</button>
      <div class="relative group">
        <button id="menuTeknologiLabel" class="px-3 py-1 text-sm font-medium rounded-md text-gray-400 hover:text-gray-200 flex items-center gap-1">Teknologi <span class="text-xs">‚ñº</span></button>
        <div class="absolute left-0 mt-2 w-56 bg-[rgba(13,20,35,0.95)] border border-cyan-500/20 rounded-lg shadow-lg hidden group-hover:block z-[10000]">
          <button onclick="switchCategory('hardwareSoftware')" id="menuTeknologi_HardwareSoftware" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">IoT</button>
          <button onclick="switchCategory('ai')" id="menuTeknologi_Ai" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">AI</button>
          <button onclick="switchCategory('web3')" id="menuTeknologi_Web3" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">Web3</button>
          <button onclick="switchCategory('teknologiUmum')" id="menuTeknologi_Umum" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">Cyber Security</button>
        </div>
      </div>
      <div class="relative group">
        <button id="menuFinanceLabel" class="px-3 py-1 text-sm font-medium rounded-md text-gray-400 hover:text-gray-200 flex items-center gap-1">Finance <span class="text-xs">‚ñº</span></button>
        <div class="absolute left-0 mt-2 w-56 bg-[rgba(13,20,35,0.95)] border border-cyan-500/20 rounded-lg shadow-lg hidden group-hover:block z-[10000]">
          <button onclick="switchCategory('fintech')" id="menuFinance_Fintech" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">Fintech</button>
          <button onclick="switchCategory('investasi')" id="menuFinance_Investasi" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">Investasi</button>
          <button onclick="switchCategory('kripto')" id="menuFinance_Kripto" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">Kripto</button>
          <button onclick="switchCategory('perencanaan')" id="menuFinance_Perencanaan" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">Perencanaan Keuangan</button>
        </div>
      </div>
      <div class="relative group">
        <button id="menuBrandingLabel" class="px-3 py-1 text-sm font-medium rounded-md text-gray-400 hover:text-gray-200 flex items-center gap-1">Bisnis & Personal Branding <span class="text-xs">‚ñº</span></button>
        <div class="absolute left-0 mt-2 w-64 bg-[rgba(13,20,35,0.95)] border border-cyan-500/20 rounded-lg shadow-lg hidden group-hover:block z-[10000]">
          <button onclick="switchCategory('bisnis')" id="menuBranding_Bisnis" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">Bisnis</button>
          <button onclick="switchCategory('personalBranding')" id="menuBranding_Personal" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">Personal Branding</button>
          <button onclick="switchCategory('marketing')" id="menuBranding_Marketing" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">Marketing</button>
        </div>
      </div>
      <div class="relative group">
        <button id="menuLifestyleLabel" class="px-3 py-1 text-sm font-medium rounded-md text-gray-400 hover:text-gray-200 flex items-center gap-1">Lifestyle Produktif <span class="text-xs">‚ñº</span></button>
        <div class="absolute left-0 mt-2 w-64 bg-[rgba(13,20,35,0.95)] border border-cyan-500/20 rounded-lg shadow-lg hidden group-hover:block z-[10000]">
          <button onclick="switchCategory('kebiasaanProduktif')" id="menuLifestyle_Kebiasaan" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">Kebiasaan Produktif</button>
          <button onclick="switchCategory('toolsProduktivitas')" id="menuLifestyle_Tools" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">Tools Produktivitas</button>
          <button onclick="switchCategory('workLifeBalance')" id="menuLifestyle_WorkLife" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">Work-Life Balance</button>
        </div>
      </div>
      <div class="relative group">
        <button id="menuInspirasiLabel" class="px-3 py-1 text-sm font-medium rounded-md text-gray-400 hover:text-gray-200 flex items-center gap-1">Inspirasi & Community Project <span class="text-xs">‚ñº</span></button>
        <div class="absolute left-0 mt-2 w-72 bg-[rgba(13,20,35,0.95)] border border-cyan-500/20 rounded-lg shadow-lg hidden group-hover:block z-[10000]">
          <button onclick="switchCategory('inspirasi')" id="menuInspirasi_Inspirasi" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">Inspirasi</button>
          <button onclick="switchCategory('communityProject')" id="menuInspirasi_Community" class="w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10">Community Project</button>
        </div>
      </div>
    </div>

     <!-- Kanan: Toggle Bahasa + Tombol Forum -->
    <div class="flex items-center gap-2">
      <!-- Toggle Bahasa -->
      <div class="flex items-center gap-1">
        <button onclick="setLang('id')" id="btnId" 
                class="px-2.5 py-1 text-xs font-medium rounded-md bg-cyan-500/20 text-cyan-300 border border-cyan-500/30">ID</button>
        <button onclick="setLang('en')" id="btnEn" 
                class="px-2.5 py-1 text-xs font-medium rounded-md text-gray-400 hover:text-gray-200">ENG</button>
      </div>

      <!-- Tombol Forum -->
      <a href="Ai.html" id="navForumLink"
         class="ml-2 bg-[rgba(0,234,255,0.15)] border border-[rgba(0,234,255,0.3)] text-white px-3 py-1.5 rounded-lg text-xs sm:text-sm transition uppercase tracking-wide no-underline flex items-center gap-1">
        Spectrum.Ai
      </a>
    </div>
  </nav>

  <!-- ===== KONTEN FORUM ===== -->
  <main id="forumMain" class="pt-20 pb-12 px-4 max-w-3xl mx-auto hidden">
    <div class="text-center mb-8">
      <h1 id="categoryTitle" class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-cyan-400 to-fuchsia-500 text-transparent bg-clip-text">Forum Kritik & Saran</h1>
      <p id="categorySubtitle" class="text-gray-400 mt-2 text-sm">Bagi kami setiap masukan sangat berharga!</p>
    </div>
    <!-- Form Tambah Topik -->
    <div id="topicFormContainer" class="bg-[rgba(13,20,35,0.7)] rounded-xl p-5 border border-cyan-500/20 mb-8">
      <h2 id="newTopicTitle" class="text-lg font-semibold mb-3 text-cyan-300">Tambahkan Topik Baru</h2>
      <input type="text" id="topicAuthorName"
             class="w-full p-3 rounded-lg bg-gray-800 text-white text-sm border border-gray-600 focus:outline-none focus:ring-1 focus:ring-cyan-400 mb-3"
             placeholder="Nama Anda (wajib)">
      <input type="text" id="topicTitle" 
             class="w-full p-3 rounded-lg bg-gray-800 text-white text-sm border border-gray-600 focus:outline-none focus:ring-1 focus:ring-cyan-400 mb-3"
             placeholder="Judul Topik">
      <textarea id="topicContent" rows="3"
                class="w-full p-3 rounded-lg bg-gray-800 text-white text-sm border border-gray-600 focus:outline-none focus:ring-1 focus:ring-cyan-400"
                placeholder="Isi topik..."></textarea>
      <input type="text" id="topicMediaUrl"
             class="w-full p-3 rounded-lg bg-gray-800 text-white text-sm border border-gray-600 focus:outline-none focus:ring-1 focus:ring-cyan-400 mt-3"
             placeholder="Add Media (URL opsional)">
      <div class="mt-3 flex justify-end">
        <button onclick="createTopic()" id="createTopicBtn"
                class="px-5 py-2 bg-fuchsia-600 hover:bg-fuchsia-500 text-white font-medium rounded-lg transition uppercase tracking-wide text-sm">
          Buat Topik
        </button>
      </div>
    </div>
    <!-- Form Penilaian Pelanggan (khusus tampil di tab Kritik) -->
    <div id="ratingSection" class="bg-[rgba(13,20,35,0.7)] rounded-xl p-5 border border-cyan-500/20 mb-8">
      <label id="ratingLabel" class="block text-gray-300 text-sm mb-2">Beri Penilaian:</label>
      <div class="flex space-x-1">
          <input type="radio" id="star5" name="rating" value="5" class="hidden peer" />
          <label for="star5" class="text-2xl text-gray-400 peer-checked:text-yellow-400 cursor-pointer">‚òÖ</label>
          <input type="radio" id="star4" name="rating" value="4" class="hidden peer" />
          <label for="star4" class="text-2xl text-gray-400 peer-checked:text-yellow-400 cursor-pointer">‚òÖ</label>
          <input type="radio" id="star3" name="rating" value="3" class="hidden peer" />
          <label for="star3" class="text-2xl text-gray-400 peer-checked:text-yellow-400 cursor-pointer">‚òÖ</label>
          <input type="radio" id="star2" name="rating" value="2" class="hidden peer" />
          <label for="star2" class="text-2xl text-gray-400 peer-checked:text-yellow-400 cursor-pointer">‚òÖ</label>
          <input type="radio" id="star1" name="rating" value="1" class="hidden peer" />
          <label for="star1" class="text-2xl text-gray-400 peer-checked:text-yellow-400 cursor-pointer">‚òÖ</label>
      </div>
      <div class="mt-3">
        <textarea id="ratingCaption" rows="3"
                  class="w-full p-3 rounded-lg bg-gray-800 text-white text-sm border border-gray-600 focus:outline-none focus:ring-1 focus:ring-cyan-400"
                  placeholder="Tulis caption penilaian (opsional)"></textarea>
      </div>
      <div class="mt-3 flex justify-end">
        <button onclick="submitRating()"
                class="px-5 py-2 bg-cyan-500 hover:bg-cyan-400 text-black font-medium rounded-lg transition uppercase tracking-wide text-sm">
          Kirim Penilaian
        </button>
      </div>
    </div>
    <!-- Daftar Topik dan Komentar -->
    <div id="commentsContainer" class="space-y-5">
      <!-- Topik dan Komentar akan muncul di sini -->
    </div>
  </main>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js    "></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js    "></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js    "></script>
  <script>
    let currentLang = 'id'; // Default ke Bahasa Indonesia
    // Inisialisasi Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDxBWbzttv2gaPVrphK-0WcaAOY1dbTxiQ",
        authDomain: "forumdb-358d4.firebaseapp.com",
        databaseURL: "https://forumdb-358d4-default-rtdb.asia-southeast1.firebasedatabase.app/", // <- Pastikan ini benar tanpa spasi
        projectId: "forumdb-358d4",
        appId: "1:690140074859:web:767450f11d2f122177722e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    // Ambil email pengguna yang login
    let currentUserEmail = null;
    let currentCategory = 'kritik'; // Default category
    let categoryListeners = [];
    let latestTopicsSnapshot = null;
    let latestCommentsSnapshot = null;
    // Fungsi untuk menampilkan modal konfirmasi kustom
    function showCustomConfirm(message, onConfirm, onCancel = () => {}) {
        const modal = document.getElementById('customConfirmModal');
        const messageEl = document.getElementById('customConfirmMessage');
        const okBtn = document.getElementById('customConfirmOK');
        const cancelBtn = document.getElementById('customConfirmCancel');
        // Set pesan
        messageEl.textContent = message;
        // Hapus event listener sebelumnya untuk mencegah penumpukan
        okBtn.onclick = null;
        cancelBtn.onclick = null;
        // Atur handler untuk tombol OK
        okBtn.onclick = function() {
            modal.classList.remove('animate-fade-in-up');
            modal.classList.add('animate-fade-out-down');
            setTimeout(() => {
                modal.classList.add('hidden');
                onConfirm(); // Panggil callback jika pengguna menekan OK
            }, 300);
        };
        // Atur handler untuk tombol Cancel
        cancelBtn.onclick = function() {
            modal.classList.remove('animate-fade-in-up');
            modal.classList.add('animate-fade-out-down');
            setTimeout(() => {
                modal.classList.add('hidden');
                onCancel(); // Panggil callback jika pengguna menekan Batal
            }, 300);
        };
        // Tampilkan modal
        modal.classList.remove('hidden');
        modal.classList.remove('animate-fade-out-down');
        modal.classList.add('animate-fade-in-up');
    }
    // --- Fungsi Like ---
    function likeTopic(topicId) {
        if (!currentUserEmail) {
            alert("Silakan login terlebih dahulu untuk menyukai topik ini.");
            return;
        }
        const sanitizedEmail = currentUserEmail.replace(/[.@]/g, '_');
        const likeRef = db.ref(`categories/${currentCategory}/topics/${topicId}/likes/${sanitizedEmail}`);
        likeRef.once('value')
            .then((snapshot) => {
                if (snapshot.exists()) {
                    // Sudah disukai, hapus like
                    likeRef.remove()
                        .then(() => console.log("Like dihapus dari topik."))
                        .catch(error => console.error("Gagal menghapus like dari topik: ", error));
                } else {
                    // Belum disukai, tambahkan like
                    likeRef.set(true)
                        .then(() => console.log("Like ditambahkan ke topik."))
                        .catch(error => console.error("Gagal menambahkan like ke topik: ", error));
                }
            })
            .catch(error => console.error("Gagal memeriksa status like topik: ", error));
    }
    function likeComment(commentId) {
        if (!currentUserEmail) {
            alert("Silakan login terlebih dahulu untuk menyukai komentar ini.");
            return;
        }
        const sanitizedEmail = currentUserEmail.replace(/[.@]/g, '_');
        const likeRef = db.ref(`categories/${currentCategory}/comments/${commentId}/likes/${sanitizedEmail}`);
        likeRef.once('value')
            .then((snapshot) => {
                if (snapshot.exists()) {
                    // Sudah disukai, hapus like
                    likeRef.remove()
                        .then(() => console.log("Like dihapus dari komentar."))
                        .catch(error => console.error("Gagal menghapus like dari komentar: ", error));
                } else {
                    // Belum disukai, tambahkan like
                    likeRef.set(true)
                        .then(() => console.log("Like ditambahkan ke komentar."))
                        .catch(error => console.error("Gagal menambahkan like ke komentar: ", error));
                }
            })
            .catch(error => console.error("Gagal memeriksa status like komentar: ", error));
    }
    // --- End Fungsi Like ---
    // Hapus topik dari Firebase
    function deleteTopic(topicId) {
        const user = auth.currentUser;
        if (!user) {
            alert("Silakan login terlebih dahulu untuk menghapus topik.");
            return;
        }
        const topicRef = db.ref(`categories/${currentCategory}/topics/${topicId}`);
        topicRef.once('value')
            .then((snapshot) => {
                const topicData = snapshot.val();
                if (!topicData) {
                    console.error("Topik tidak ditemukan.");
                    return;
                }
                if (topicData.userEmail === user.email) {
                     showCustomConfirm(
                         "Apakah Anda yakin ingin menghapus topik ini?",
                         () => {
                             topicRef.remove()
                                 .then(() => {
                                     console.log("Topik berhasil dihapus.");
                                     // renderComments akan dipanggil otomatis oleh listener
                                 })
                                 .catch(error => {
                                     console.error("Gagal menghapus topik: ", error);
                                     alert("Gagal menghapus topik.");
                                 });
                         }
                     );
                } else {
                    alert("Anda tidak berhak menghapus topik ini.");
                }
            })
            .catch(error => {
                console.error("Gagal membaca data topik untuk verifikasi: ", error);
                alert("Gagal memverifikasi pemilik topik.");
            });
    }
    // Hapus komentar dari Firebase
    function deleteComment(commentId) {
        const user = auth.currentUser; // Dapatkan user yang sedang login dari Firebase Auth
        if (!user) {
            alert("Silakan login terlebih dahulu untuk menghapus komentar.");
            return;
        }
        // Ambil referensi komentar
        const commentRef = db.ref(`categories/${currentCategory}/comments/${commentId}`);
        // Ambil data komentar untuk memeriksa pemiliknya
        commentRef.once('value')
            .then((snapshot) => {
                const commentData = snapshot.val();
                if (!commentData) {
                    console.error("Komentar tidak ditemukan.");
                    return;
                }
                // Bandingkan email pengguna yang login dengan email pemilik komentar
                if (commentData.userEmail === user.email) {
                     // Jika cocok, tampilkan konfirmasi dan hapus
                     showCustomConfirm(
                         "Apakah Anda yakin ingin menghapus komentar ini?",
                         () => {
                             commentRef.remove()
                                 .then(() => {
                                     console.log("Komentar berhasil dihapus.");
                                 })
                                 .catch(error => {
                                     console.error("Gagal menghapus komentar: ", error);
                                     alert("Gagal menghapus komentar.");
                                 });
                         }
                     );
                } else {
                    alert("Anda tidak berhak menghapus komentar ini.");
                }
            })
            .catch(error => {
                console.error("Gagal membaca data komentar untuk verifikasi: ", error);
                alert("Gagal memverifikasi pemilik komentar.");
            });
    }
    // Render topik dan komentar dari Firebase
    function renderComments() {
        const container = document.getElementById('commentsContainer');
        container.innerHTML = ''; // Bersihkan kontainer sebelum render
        // Ambil referensi ke topik dan komentar
        const topicsRef = db.ref(`categories/${currentCategory}/topics`);
        const commentsRef = db.ref(`categories/${currentCategory}/comments`);
        // Gabungkan data dari topik dan komentar
        Promise.all([
            topicsRef.once('value'),
            commentsRef.once('value')
        ]).then(([topicsSnapshot, commentsSnapshot]) => {
            const topics = [];
            const comments = [];
            topicsSnapshot.forEach(child => {
                // Inisialisasi likes jika tidak ada
                const topicData = { id: child.key, ...child.val(), type: 'topic' };
                if (!topicData.likes) topicData.likes = {};
                topics.push(topicData);
            });
            commentsSnapshot.forEach(child => {
                // Inisialisasi likes jika tidak ada
                const commentData = { id: child.key, ...child.val(), type: 'comment' };
                if (!commentData.likes) commentData.likes = {};
                comments.push(commentData);
            });
            // Gabungkan dan urutkan berdasarkan timestamp terbaru
            const allItems = [...topics, ...comments];
            const sorted = allItems.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            if (sorted.length === 0) {
                container.innerHTML = `<div class="text-center py-10"><p class="text-gray-500 italic">Belum ada topik atau komentar di kategori ini. Jadilah yang pertama!</p></div>`;
                return;
            }
            sorted.forEach(item => {
                const el = document.createElement('div');
                el.className = 'bg-[rgba(10,18,30,0.6)] p-5 rounded-xl border border-[rgba(0,234,255,0.1)] mb-4'; // Tambahkan margin bottom
                const timestamp = item.timestamp ? new Date(item.timestamp).toLocaleString('id-ID') : 'Tidak ada waktu';
                const isOwner = item.userEmail === currentUserEmail;
                const displayAuthor = item.type === 'topic' ? (item.userName || 'Anonim') : (item.userName || 'Anonim');
                // --- Hitung dan cek like ---
                const likes = item.likes || {};
                const likeCount = Object.keys(likes).length;
                const isLikedByCurrentUser = currentUserEmail ? likes[currentUserEmail.replace(/[.@]/g, '_')] === true : false;
                // --- End Hitung dan cek like ---
                if (item.type === 'topic') {
                    el.id = `topic-${item.id}`;
                    const topicReplyCount = item.replies ? Object.keys(item.replies).length : 0;
                    el.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="font-bold text-xl text-fuchsia-300">${item.title}</span>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="font-semibold text-cyan-300">${displayAuthor}</span>
                                    <span class="text-gray-500 text-xs">${timestamp}</span>
                                </div>
                            </div>
                            ${isOwner ? `<button onclick="deleteTopic('${item.id}')" 
                                            class="text-red-400 hover:text-red-300 text-xs flex items-center gap-1 ml-2 focus:outline-none focus:ring-1 focus:ring-red-400 rounded">üóëÔ∏è Hapus Topik</button>` : ''}
                        </div>
                        <p class="text-gray-200 mt-3 whitespace-pre-wrap">${item.content || ''}</p>
                        ${item.mediaUrl ? `<div class="mt-3"><img src="${item.mediaUrl}" referrerpolicy="no-referrer" class="rounded-lg border border-cyan-500/20 max-h-64 w-full object-contain" onerror="this.onerror=function(){ this.parentElement.innerHTML='<a href=\'${item.mediaUrl}\' target=\'_blank\' rel=\'noopener noreferrer\' class=\'text-cyan-300 underline\'>Lihat Media</a>'; }; this.src='https://images.weserv.nl/?url='+encodeURIComponent('${item.mediaUrl}');"/></div>` : ''}
                        ${item.mediaUrl ? `<div class="mt-3"><img src="${item.mediaUrl}" referrerpolicy="no-referrer" class="rounded-lg border border-cyan-500/20 max-h-64 w-full object-contain" onerror="this.onerror=function(){ this.parentElement.innerHTML='<a href=\'${item.mediaUrl}\' target=\'_blank\' rel=\'noopener noreferrer\' class=\'text-cyan-300 underline\'>Lihat Media</a>'; }; this.src='https://images.weserv.nl/?url='+encodeURIComponent('${item.mediaUrl}');"/></div>` : ''}
                        <div class="mt-3 flex items-center gap-4">
                            <button onclick="likeTopic('${item.id}')" class="like-btn flex items-center gap-1 ${isLikedByCurrentUser ? 'text-red-500' : 'text-gray-400 hover:text-red-400'}">
                                ${isLikedByCurrentUser ? '‚ù§Ô∏è' : 'ü§ç'} <span class="like-count ml-1">${likeCount}</span>
                            </button>
                            <button onclick="toggleTopicReplyForm('${item.id}')" class="text-gray-400 hover:text-purple-300 flex items-center gap-1">
                                ‚úçÔ∏è Balas
                            </button>
                            <button onclick="toggleTopicReplies('${item.id}')" class="text-gray-400 hover:text-cyan-300 flex items-center gap-1 reply-toggle">
                                üìÇ Tampilkan Balasan (${topicReplyCount})
                            </button>
                        </div>
                        <div id="topic-reply-form-${item.id}" class="mt-3 hidden">
                            <textarea id="topic-reply-textarea-${item.id}" rows="3" placeholder="Tulis balasan Anda untuk topik ini..." class="w-full p-2 text-sm rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-1 focus:ring-cyan-400"></textarea>
                            <div class="mt-2 flex items-center gap-2">
                                <button onclick="postTopicReply('${item.id}')" class="px-3 py-1.5 bg-purple-600 hover:bg-purple-500 text-white rounded text-sm">Kirim Balasan</button>
                                <button onclick="toggleTopicReplyForm('${item.id}')" class="px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm">Batal</button>
                                
                            </div>
                        </div>
                        <div id="topic-replies-${item.id}" class="mt-3 pl-4 border-l-2 border-gray-700 space-y-3 hidden">
                            ${item.replies && Object.keys(item.replies).length > 0 ? Object.entries(item.replies).map(([rid, rdata]) => {
                                const rts = rdata.timestamp ? new Date(rdata.timestamp).toLocaleString('id-ID') : 'Tidak ada waktu';
                                const rauthor = rdata.userName || 'Anonim';
                                const canDeleteTopicReply = currentUserEmail && rdata.userEmail === currentUserEmail;
                                return `
                                    <div class=\"bg-[rgba(5,12,22,0.5)] p-3 rounded-lg reply-card\">
                                        <div class=\"flex justify-between\">
                                            <span class=\"text-sm text-purple-300\">${rauthor}</span>
                                            <div class=\"flex items-center gap-2\">
                                                <span class=\"text-gray-500 text-xs\">${rts}</span>
                                                ${canDeleteTopicReply ? `<button onclick=\"deleteTopicReply('${item.id}','${rid}')\" class=\"text-red-400 hover:text-red-300 text-xs\">üóëÔ∏è Hapus</button>` : ''}
                                            </div>
                                        </div>
                                        <p class=\"text-gray-300 text-sm mt-1\">${rdata.text || ''}</p>
                                    </div>
                                `;
                            }).join('') : `<div class=\"text-gray-500 text-sm italic\">Belum ada balasan untuk topik ini.</div>`}
                        </div>
                    `;
                } else {
                    // Render Komentar (seperti sebelumnya)
                    let ratingHtml = '';
                    if (item.rating) {
                        let stars = '';
                        for (let i = 1; i <= 5; i++) {
                            if (i <= item.rating) {
                                stars += '‚òÖ';
                            } else {
                                stars += '‚òÜ';
                            }
                        }
                        ratingHtml = `<div class="mt-2 text-sm text-yellow-400">${stars} (${item.rating}/5)</div>`;
                    }
                    const replyCount = item.replies ? Object.keys(item.replies).length : 0;
                    let repliesHtml = '';
                    // Kontainer balasan dengan toggle
                    repliesHtml += `<div class="mt-3">
                        <button onclick="toggleReplies('${item.id}')" class="text-gray-400 hover:text-cyan-300 text-sm flex items-center gap-1 reply-toggle">
                            üìÇ Tampilkan Balasan (${replyCount})
                        </button>
                    </div>`;
                    let repliesList = '';
                    repliesList += `<div id="replies-${item.id}" class="mt-3 pl-4 border-l-2 border-gray-700 space-y-3 hidden">`;
                    if (item.replies && Object.keys(item.replies).length > 0) {
                        Object.entries(item.replies).forEach(([replyId, replyData]) => {
                            const replyTimestamp = replyData.timestamp ? new Date(replyData.timestamp).toLocaleString('id-ID') : 'Tidak ada waktu';
                            const displayReplyAuthor = replyData.userName || 'Anonim';
                            const canDeleteReply = currentUserEmail && replyData.userEmail === currentUserEmail;
                            repliesList += `
                                <div class="bg-[rgba(5,12,22,0.5)] p-3 rounded-lg reply-card">
                                    <div class="flex justify-between">
                                        <span class="text-sm text-purple-300">${displayReplyAuthor}</span>
                                        <div class="flex items-center gap-2">
                                            <span class="text-gray-500 text-xs">${replyTimestamp}</span>
                                            ${canDeleteReply ? `<button onclick="deleteCommentReply('${item.id}','${replyId}')" class="text-red-400 hover:text-red-300 text-xs">üóëÔ∏è Hapus</button>` : ''}
                                        </div>
                                    </div>
                                    <p class="text-gray-300 text-sm mt-1">${replyData.text || ''}</p>
                                </div>
                            `;
                        });
                    } else {
                        repliesList += `<div class="text-gray-500 text-sm italic">Belum ada balasan untuk komentar ini.</div>`;
                    }
                    repliesList += `</div>`;
                    el.id = `comment-${item.id}`;
                    el.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="font-semibold text-cyan-300">${displayAuthor}</span>
                                <span class="text-gray-500 text-xs ml-2">${timestamp}</span>
                            </div>
                            ${isOwner ? `<button onclick="deleteComment('${item.id}')" 
                                            class="text-red-400 hover:text-red-300 text-xs flex items-center gap-1 ml-2 focus:outline-none focus:ring-1 focus:ring-red-400 rounded">üóëÔ∏è Hapus</button>` : ''}
                        </div>
                        <p class="text-gray-200 mt-3 whitespace-pre-wrap">${item.text || ''}</p>
                        ${ratingHtml}
                        <div class="mt-3 flex items-center gap-4">
                            <button onclick="likeComment('${item.id}')" class="like-btn flex items-center gap-1 ${isLikedByCurrentUser ? 'text-red-500' : 'text-gray-400 hover:text-red-400'}">
                                ${isLikedByCurrentUser ? '‚ù§Ô∏è' : 'ü§ç'} <span class="like-count ml-1">${likeCount}</span>
                            </button>
                            <button onclick="toggleReplyForm('${item.id}')" class="text-gray-400 hover:text-purple-300 flex items-center gap-1">
                                ‚úçÔ∏è Balas
                            </button>
                        </div>
                        <div id="reply-form-${item.id}" class="mt-3 hidden">
                            <textarea id="reply-textarea-${item.id}" rows="3" placeholder="Tulis balasan Anda..." class="w-full p-2 text-sm rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-1 focus:ring-cyan-400"></textarea>
                            <div class="mt-2 flex items-center gap-2">
                                <button onclick="postReply('${item.id}')" class="px-3 py-1.5 bg-purple-600 hover:bg-purple-500 text-white rounded text-sm">Kirim Balasan</button>
                                <button onclick="toggleReplyForm('${item.id}')" class="px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm">Batal</button>
                                
                            </div>
                        </div>
                        ${repliesHtml}
                        ${repliesList}
                    `;
                }
                container.appendChild(el);
            });
        }).catch(error => {
            console.error("Gagal mengambil data topik atau komentar: ", error);
        });
    }
    function renderRealtimeComments() {
        const container = document.getElementById('commentsContainer');
        container.innerHTML = '';
        if (!latestTopicsSnapshot || !latestCommentsSnapshot) return;
        const topics = [];
        const comments = [];
        latestTopicsSnapshot.forEach(child => {
            const topicData = { id: child.key, ...child.val(), type: 'topic' };
            if (!topicData.likes) topicData.likes = {};
            topics.push(topicData);
        });
        latestCommentsSnapshot.forEach(child => {
            const commentData = { id: child.key, ...child.val(), type: 'comment' };
            if (!commentData.likes) commentData.likes = {};
            comments.push(commentData);
        });
        const allItems = [...topics, ...comments];
        const sorted = allItems.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        if (sorted.length === 0) {
            container.innerHTML = `<div class="text-center py-10"><p class="text-gray-500 italic">Belum ada topik atau komentar di kategori ini. Jadilah yang pertama!</p></div>`;
            return;
        }
        sorted.forEach(item => {
            const el = document.createElement('div');
            el.className = 'bg-[rgba(10,18,30,0.6)] p-5 rounded-xl border border-[rgba(0,234,255,0.1)] mb-4';
            const timestamp = item.timestamp ? new Date(item.timestamp).toLocaleString('id-ID') : 'Tidak ada waktu';
            const isOwner = item.userEmail === currentUserEmail;
            const displayAuthor = item.type === 'topic' ? (item.userName || 'Anonim') : (item.userName || 'Anonim');
            const likes = item.likes || {};
            const likeCount = Object.keys(likes).length;
            const isLikedByCurrentUser = currentUserEmail ? likes[currentUserEmail.replace(/[.@]/g, '_')] === true : false;
            if (item.type === 'topic') {
                el.id = `topic-${item.id}`;
                const topicReplyCount = item.replies ? Object.keys(item.replies).length : 0;
                el.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="font-bold text-xl text-fuchsia-300">${item.title}</span>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="font-semibold text-cyan-300">${displayAuthor}</span>
                                    <span class="text-gray-500 text-xs">${timestamp}</span>
                                </div>
                            </div>
                            ${isOwner ? `<button onclick="deleteTopic('${item.id}')" 
                                            class="text-red-400 hover:text-red-300 text-xs flex items-center gap-1 ml-2 focus:outline-none focus:ring-1 focus:ring-red-400 rounded">üóëÔ∏è Hapus Topik</button>` : ''}
                        </div>
                        <p class="text-gray-200 mt-3 whitespace-pre-wrap">${item.content || ''}</p>
                        <div class="mt-3 flex items-center gap-4">
                            <button onclick="likeTopic('${item.id}')" class="like-btn flex items-center gap-1 ${isLikedByCurrentUser ? 'text-red-500' : 'text-gray-400 hover:text-red-400'}">
                                ${isLikedByCurrentUser ? '‚ù§Ô∏è' : 'ü§ç'} <span class="like-count ml-1">${likeCount}</span>
                            </button>
                            <button onclick="toggleTopicReplyForm('${item.id}')" class="text-gray-400 hover:text-purple-300 flex items-center gap-1">
                                ‚úçÔ∏è Balas
                            </button>
                            <button onclick="toggleTopicReplies('${item.id}')" class="text-gray-400 hover:text-cyan-300 flex items-center gap-1 reply-toggle">
                                üìÇ Tampilkan Balasan (${topicReplyCount})
                            </button>
                        </div>
                        <div id="topic-reply-form-${item.id}" class="mt-3 hidden">
                            <textarea id="topic-reply-textarea-${item.id}" rows="3" placeholder="Tulis balasan Anda untuk topik ini..." class="w-full p-2 text-sm rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-1 focus:ring-cyan-400"></textarea>
                            <div class="mt-2 flex items-center gap-2">
                                <button onclick="postTopicReply('${item.id}')" class="px-3 py-1.5 bg-purple-600 hover:bg-purple-500 text-white rounded text-sm">Kirim Balasan</button>
                                <button onclick="toggleTopicReplyForm('${item.id}')" class="px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm">Batal</button>
                            </div>
                        </div>
                        <div id="topic-replies-${item.id}" class="mt-3 pl-4 border-l-2 border-gray-700 space-y-3 hidden">
                            ${item.replies && Object.keys(item.replies).length > 0 ? Object.entries(item.replies).map(([rid, rdata]) => {
                                const rts = rdata.timestamp ? new Date(rdata.timestamp).toLocaleString('id-ID') : 'Tidak ada waktu';
                                const rauthor = rdata.userName || 'Anonim';
                                const canDeleteTopicReply = currentUserEmail && rdata.userEmail === currentUserEmail;
                                return `
                                    <div class=\"bg-[rgba(5,12,22,0.5)] p-3 rounded-lg reply-card\">
                                        <div class=\"flex justify-between\">
                                            <span class=\"text-sm text-purple-300\">${rauthor}</span>
                                            <div class=\"flex items-center gap-2\">
                                                <span class=\"text-gray-500 text-xs\">${rts}</span>
                                                ${canDeleteTopicReply ? `<button onclick=\"deleteTopicReply('${item.id}','${rid}')\" class=\"text-red-400 hover:text-red-300 text-xs\">üóëÔ∏è Hapus</button>` : ''}
                                            </div>
                                        </div>
                                        <p class=\"text-gray-300 text-sm mt-1\">${rdata.text || ''}</p>
                                    </div>
                                `;
                            }).join('') : `<div class=\"text-gray-500 text-sm italic\">Belum ada balasan untuk topik ini.</div>`}
                        </div>
                    `;
            } else {
                let ratingHtml = '';
                if (item.rating) {
                    let stars = '';
                    for (let i = 1; i <= 5; i++) {
                        if (i <= item.rating) {
                            stars += '‚òÖ';
                        } else {
                            stars += '‚òÜ';
                        }
                    }
                    ratingHtml = `<div class="mt-2 text-sm text-yellow-400">${stars} (${item.rating}/5)</div>`;
                }
                const replyCount = item.replies ? Object.keys(item.replies).length : 0;
                let repliesHtml = '';
                repliesHtml += `<div class="mt-3">
                        <button onclick="toggleReplies('${item.id}')" class="text-gray-400 hover:text-cyan-300 text-sm flex items-center gap-1 reply-toggle">
                            üìÇ Tampilkan Balasan (${replyCount})
                        </button>
                    </div>`;
                let repliesList = '';
                repliesList += `<div id="replies-${item.id}" class="mt-3 pl-4 border-l-2 border-gray-700 space-y-3 hidden">`;
                if (item.replies && Object.keys(item.replies).length > 0) {
                    Object.entries(item.replies).forEach(([replyId, replyData]) => {
                        const replyTimestamp = replyData.timestamp ? new Date(replyData.timestamp).toLocaleString('id-ID') : 'Tidak ada waktu';
                        const displayReplyAuthor = replyData.userName || 'Anonim';
                        const canDeleteReply = currentUserEmail && replyData.userEmail === currentUserEmail;
                        repliesList += `
                                <div class="bg-[rgba(5,12,22,0.5)] p-3 rounded-lg reply-card">
                                    <div class="flex justify-between">
                                        <span class="text-sm text-purple-300">${displayReplyAuthor}</span>
                                        <div class="flex items-center gap-2">
                                            <span class="text-gray-500 text-xs">${replyTimestamp}</span>
                                            ${canDeleteReply ? `<button onclick="deleteCommentReply('${item.id}','${replyId}')" class="text-red-400 hover:text-red-300 text-xs">üóëÔ∏è Hapus</button>` : ''}
                                        </div>
                                    </div>
                                    <p class="text-gray-300 text-sm mt-1">${replyData.text || ''}</p>
                                </div>
                            `;
                    });
                } else {
                    repliesList += `<div class="text-gray-500 text-sm italic">Belum ada balasan untuk komentar ini.</div>`;
                }
                repliesList += `</div>`;
                el.id = `comment-${item.id}`;
                el.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="font-semibold text-cyan-300">${displayAuthor}</span>
                                <span class="text-gray-500 text-xs ml-2">${timestamp}</span>
                            </div>
                            ${isOwner ? `<button onclick="deleteComment('${item.id}')" 
                                            class="text-red-400 hover:text-red-300 text-xs flex items-center gap-1 ml-2 focus:outline-none focus:ring-1 focus:ring-red-400 rounded">üóëÔ∏è Hapus</button>` : ''}
                        </div>
                        <p class="text-gray-200 mt-3 whitespace-pre-wrap">${item.text || ''}</p>
                        ${ratingHtml}
                        <div class="mt-3 flex items-center gap-4">
                            <button onclick="likeComment('${item.id}')" class="like-btn flex items-center gap-1 ${isLikedByCurrentUser ? 'text-red-500' : 'text-gray-400 hover:text-red-400'}">
                                ${isLikedByCurrentUser ? '‚ù§Ô∏è' : 'ü§ç'} <span class="like-count ml-1">${likeCount}</span>
                            </button>
                            <button onclick="toggleReplyForm('${item.id}')" class="text-gray-400 hover:text-purple-300 flex items-center gap-1">
                                ‚úçÔ∏è Balas
                            </button>
                        </div>
                        <div id="reply-form-${item.id}" class="mt-3 hidden">
                            <textarea id="reply-textarea-${item.id}" rows="3" placeholder="Tulis balasan Anda..." class="w-full p-2 text-sm rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-1 focus:ring-cyan-400"></textarea>
                            <div class="mt-2 flex items-center gap-2">
                                <button onclick="postReply('${item.id}')" class="px-3 py-1.5 bg-purple-600 hover:bg-purple-500 text-white rounded text-sm">Kirim Balasan</button>
                                <button onclick="toggleReplyForm('${item.id}')" class="px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm">Batal</button>
                            </div>
                        </div>
                        ${repliesHtml}
                        ${repliesList}
                    `;
            }
            container.appendChild(el);
        });
    }
    function detachCategoryListeners() {
        categoryListeners.forEach(l => { l.ref.off('value', l.cb); });
        categoryListeners = [];
        latestTopicsSnapshot = null;
        latestCommentsSnapshot = null;
    }
    function attachCategoryListeners() {
        detachCategoryListeners();
        const tRef = db.ref(`categories/${currentCategory}/topics`);
        const cRef = db.ref(`categories/${currentCategory}/comments`);
        const tcb = snap => { latestTopicsSnapshot = snap; if (latestCommentsSnapshot) renderRealtimeComments(); };
        const ccb = snap => { latestCommentsSnapshot = snap; if (latestTopicsSnapshot) renderRealtimeComments(); };
        tRef.on('value', tcb);
        cRef.on('value', ccb);
        categoryListeners = [{ref: tRef, cb: tcb}, {ref: cRef, cb: ccb}];
    }
    // Fungsi untuk membuat topik baru
    async function createTopic() {
        if (!currentUserEmail) {
            alert("Silakan login terlebih dahulu untuk membuat topik.");
            return;
        }
        const btn = document.getElementById('createTopicBtn');
        const originalText = btn ? btn.textContent : '';
        if (btn) { btn.disabled = true; btn.textContent = currentLang === 'id' ? 'Mengirim...' : 'Posting...'; }
        const authorName = document.getElementById('topicAuthorName').value.trim();
        const title = document.getElementById('topicTitle').value.trim();
        const content = document.getElementById('topicContent').value.trim();
        const mediaUrl = (document.getElementById('topicMediaUrl')?.value || '').trim();
        if (!authorName) {
            alert('Mohon isi nama Anda terlebih dahulu.');
            if (btn) { btn.disabled = false; btn.textContent = originalText; }
            return;
        }
        if (!title || !content) {
            alert('Mohon isi judul dan isi topik.');
            if (btn) { btn.disabled = false; btn.textContent = originalText; }
            return;
        }
        try {
            const topicsRef = db.ref(`categories/${currentCategory}/topics`);
            const newRef = topicsRef.push();
            const topicData = {
                title: title,
                content: content,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                userEmail: currentUserEmail,
                userName: authorName,
                likes: {},
                mediaUrl: mediaUrl || null
            };
            await newRef.set(topicData);
        } catch (err) {
            console.error('Gagal membuat topik:', err);
            alert((currentLang === 'id' ? 'Gagal membuat topik: ' : 'Failed to create topic: ') + (err && err.message ? err.message : 'Unknown error'));
        }
        // Reset form
        document.getElementById('topicAuthorName').value = '';
        document.getElementById('topicTitle').value = '';
        document.getElementById('topicContent').value = '';
        const mediaInput = document.getElementById('topicMediaUrl');
        if (mediaInput) mediaInput.value = '';
        if (btn) { btn.disabled = false; btn.textContent = originalText; }
    }
    // Kirim penilaian pelanggan (tanpa pesan) ke Firebase pada kategori kritik
    function submitRating() {
        if (!currentUserEmail) {
            alert(currentLang === 'en' ? 'Please login first.' : 'Silakan login terlebih dahulu.');
            return;
        }
        if (currentCategory !== 'kritik') {
            alert(currentLang === 'en' ? 'Rating only available in Critics tab.' : 'Penilaian hanya tersedia di tab Kritik.');
            return;
        }
        const selectedRating = document.querySelector('input[name="rating"]:checked');
        const rating = selectedRating ? parseInt(selectedRating.value) : null;
        if (!rating) {
            alert(currentLang === 'en' ? 'Please select a rating.' : 'Silakan pilih penilaian.');
            return;
        }
        const captionEl = document.getElementById('ratingCaption');
        const caption = captionEl ? captionEl.value.trim() : '';
        const commentData = {
            timestamp: firebase.database.ServerValue.TIMESTAMP,
            likes: {},
            userEmail: currentUserEmail,
            rating: rating
        };
        if (caption) {
            commentData.text = caption;
        }
        const commentsRef = db.ref(`categories/kritik/comments`);
        commentsRef.push(commentData);
        document.querySelectorAll('input[name="rating"]').forEach(radio => radio.checked = false);
        if (captionEl) captionEl.value = '';
    }
    // Kirim balasan ke Firebase (nested di bawah komentar)
    function postReply(commentId) {
        if (!currentUserEmail) {
            alert("Silakan login terlebih dahulu untuk membalas komentar.");
            return;
        }
        const input = document.getElementById(`reply-textarea-${commentId}`);
        const text = input ? input.value.trim() : '';
        if (!text) return;
        const replyData = {
            text: text,
            timestamp: firebase.database.ServerValue.TIMESTAMP,
            userEmail: currentUserEmail // Simpan email pengguna yang login
        };
        // Simpan ke Firebase di bawah kategori dan komentar yang dipilih
        const newReplyRef = db.ref(`categories/${currentCategory}/comments/${commentId}/replies`).push(); // Gunakan currentCategory
        newReplyRef.set(replyData).then(() => {
            input.value = '';
            // Pastikan daftar balasan terlihat setelah mengirim
            const list = document.getElementById(`replies-${commentId}`);
            if (list && list.classList.contains('hidden')) {
                list.classList.remove('hidden');
            }
            // Tutup form balasan untuk kebersihan UI
            const form = document.getElementById(`reply-form-${commentId}`);
            if (form && !form.classList.contains('hidden')) {
                form.classList.add('hidden');
            }
        }).catch(error => {
            console.error("Gagal mengirim balasan: ", error);
            alert("Gagal mengirim balasan.");
        });
    }
    // Kirim balasan untuk Topik
    function postTopicReply(topicId) {
        if (!currentUserEmail) {
            alert("Silakan login terlebih dahulu untuk membalas topik.");
            return;
        }
        const input = document.getElementById(`topic-reply-textarea-${topicId}`);
        const text = input ? input.value.trim() : '';
        if (!text) return;
        const replyData = {
            text: text,
            timestamp: firebase.database.ServerValue.TIMESTAMP,
            userEmail: currentUserEmail
        };
        const newReplyRef = db.ref(`categories/${currentCategory}/topics/${topicId}/replies`).push();
        newReplyRef.set(replyData).then(() => {
            input.value = '';
            const list = document.getElementById(`topic-replies-${topicId}`);
            if (list && list.classList.contains('hidden')) list.classList.remove('hidden');
            const form = document.getElementById(`topic-reply-form-${topicId}`);
            if (form && !form.classList.contains('hidden')) form.classList.add('hidden');
        }).catch(error => {
            console.error("Gagal mengirim balasan topik: ", error);
            alert("Gagal mengirim balasan topik.");
        });
    }
    // Toggle form balasan untuk Topik
    function toggleTopicReplyForm(topicId) {
        const form = document.getElementById(`topic-reply-form-${topicId}`);
        if (!form) return;
        form.classList.toggle('hidden');
        if (!form.classList.contains('hidden')) {
            const ta = document.getElementById(`topic-reply-textarea-${topicId}`);
            if (ta) ta.focus();
        }
    }
    // Toggle daftar balasan untuk Topik
    function toggleTopicReplies(topicId) {
        const list = document.getElementById(`topic-replies-${topicId}`);
        if (!list) return;
        list.classList.toggle('hidden');
    }
    // Toggle tampilan form balasan
    function toggleReplyForm(commentId) {
        const form = document.getElementById(`reply-form-${commentId}`);
        if (!form) return;
        form.classList.toggle('hidden');
        if (!form.classList.contains('hidden')) {
            const ta = document.getElementById(`reply-textarea-${commentId}`);
            if (ta) ta.focus();
        }
    }
    // Toggle daftar balasan
    function toggleReplies(commentId) {
        const list = document.getElementById(`replies-${commentId}`);
        if (!list) return;
        list.classList.toggle('hidden');
    }

    // Hapus balasan pada komentar
    async function deleteCommentReply(commentId, replyId) {
        try {
            const user = auth.currentUser;
            if (!user) {
                alert(currentLang === 'en' ? 'Please login first.' : 'Silakan login terlebih dahulu.');
                return;
            }
            const replyRef = db.ref(`categories/${currentCategory}/comments/${commentId}/replies/${replyId}`);
            const snap = await replyRef.get();
            if (!snap.exists()) {
                alert(currentLang === 'en' ? 'Reply not found.' : 'Balasan tidak ditemukan.');
                return;
            }
            const data = snap.val();
            if (data.userEmail !== user.email) {
                alert(currentLang === 'en' ? 'You can only delete your own reply.' : 'Anda hanya dapat menghapus balasan Anda sendiri.');
                return;
            }
            showCustomConfirm(
                currentLang === 'en' ? 'Delete this reply?' : 'Hapus balasan ini?',
                async () => {
                    try {
                        await replyRef.remove();
                        switchCategory(currentCategory);
                    } catch (err) {
                        console.error('Error deleting comment reply', err);
                        alert(currentLang === 'en' ? 'Failed to delete reply.' : 'Gagal menghapus balasan.');
                    }
                }
            );
        } catch (err) {
            console.error('Error preparing delete comment reply', err);
            alert(currentLang === 'en' ? 'Failed to delete reply.' : 'Gagal menghapus balasan.');
        }
    }

    // Hapus balasan pada topik
    async function deleteTopicReply(topicId, replyId) {
        try {
            const user = auth.currentUser;
            if (!user) {
                alert(currentLang === 'en' ? 'Please login first.' : 'Silakan login terlebih dahulu.');
                return;
            }
            const replyRef = db.ref(`categories/${currentCategory}/topics/${topicId}/replies/${replyId}`);
            const snap = await replyRef.get();
            if (!snap.exists()) {
                alert(currentLang === 'en' ? 'Reply not found.' : 'Balasan tidak ditemukan.');
                return;
            }
            const data = snap.val();
            if (data.userEmail !== user.email) {
                alert(currentLang === 'en' ? 'You can only delete your own reply.' : 'Anda hanya dapat menghapus balasan Anda sendiri.');
                return;
            }
            showCustomConfirm(
                currentLang === 'en' ? 'Delete this reply?' : 'Hapus balasan ini?',
                async () => {
                    try {
                        await replyRef.remove();
                        switchCategory(currentCategory);
                    } catch (err) {
                        console.error('Error deleting topic reply', err);
                        alert(currentLang === 'en' ? 'Failed to delete reply.' : 'Gagal menghapus balasan.');
                    }
                }
            );
        } catch (err) {
            console.error('Error preparing delete topic reply', err);
            alert(currentLang === 'en' ? 'Failed to delete reply.' : 'Gagal menghapus balasan.');
        }
    }
    // Fungsi untuk mengganti kategori
    function switchCategory(category) {
    currentCategory = category;

    // Reset highlight untuk semua tombol kategori
    const menuButtons = [
        document.getElementById('menuKritik'),
        document.getElementById('menuTeknologi_HardwareSoftware'),
        document.getElementById('menuTeknologi_Ai'),
        document.getElementById('menuTeknologi_Web3'),
        document.getElementById('menuTeknologi_Umum'),
        document.getElementById('menuFinance_Fintech'),
        document.getElementById('menuFinance_Investasi'),
        document.getElementById('menuFinance_Kripto'),
        document.getElementById('menuFinance_Perencanaan'),
        document.getElementById('menuBranding_Bisnis'),
        document.getElementById('menuBranding_Personal'),
        document.getElementById('menuBranding_Marketing'),
        document.getElementById('menuLifestyle_Kebiasaan'),
        document.getElementById('menuLifestyle_Tools'),
        document.getElementById('menuLifestyle_WorkLife'),
        document.getElementById('menuInspirasi_Inspirasi'),
        document.getElementById('menuInspirasi_Community')
    ];

    menuButtons.forEach(btn => {
        if (btn) {
            if (btn.id === 'menuKritik') {
                btn.className = 'px-3 py-1 text-sm font-medium rounded-md text-gray-400 hover:text-gray-200';
            } else {
                btn.className = 'w-full text-left px-3 py-2 text-sm font-medium text-gray-300 hover:text-cyan-200 hover:bg-cyan-500/10';
            }
        }
    });

    // Tambahkan highlight ke tombol yang sesuai dengan kategori yang dipilih
    // Gunakan `category` untuk menentukan ID tombol yang benar
    let activeButtonId = '';
    switch (category) {
        case 'kritik':
            activeButtonId = 'menuKritik';
            break;
        case 'hardwareSoftware':
            activeButtonId = 'menuTeknologi_HardwareSoftware';
            break;
        case 'ai':
            activeButtonId = 'menuTeknologi_Ai';
            break;
        case 'web3':
            activeButtonId = 'menuTeknologi_Web3';
            break;
        case 'teknologiUmum':
            activeButtonId = 'menuTeknologi_Umum';
            break;
        case 'fintech':
            activeButtonId = 'menuFinance_Fintech';
            break;
        case 'investasi':
            activeButtonId = 'menuFinance_Investasi';
            break;
        case 'kripto':
            activeButtonId = 'menuFinance_Kripto';
            break;
        case 'perencanaan':
            activeButtonId = 'menuFinance_Perencanaan';
            break;
        case 'bisnis':
            activeButtonId = 'menuBranding_Bisnis';
            break;
        case 'personalBranding':
            activeButtonId = 'menuBranding_Personal';
            break;
        case 'marketing':
            activeButtonId = 'menuBranding_Marketing';
            break;
        case 'kebiasaanProduktif':
            activeButtonId = 'menuLifestyle_Kebiasaan';
            break;
        case 'toolsProduktivitas':
            activeButtonId = 'menuLifestyle_Tools';
            break;
        case 'workLifeBalance':
            activeButtonId = 'menuLifestyle_WorkLife';
            break;
        case 'inspirasi':
            activeButtonId = 'menuInspirasi_Inspirasi';
            break;
        case 'communityProject':
            activeButtonId = 'menuInspirasi_Community';
            break;
        default:
            console.warn(`Kategori tidak dikenali: ${category}`);
    }

    if (activeButtonId) {
        const activeBtn = document.getElementById(activeButtonId);
        if (activeBtn) {
            if (activeBtn.id === 'menuKritik') {
                activeBtn.className = 'px-3 py-1 text-sm font-medium rounded-md bg-cyan-500/20 text-cyan-300 border border-cyan-500/30';
            } else {
                activeBtn.className = 'w-full text-left px-3 py-2 text-sm font-medium bg-cyan-500/20 text-cyan-300';
            }
        }
    }

    // Update judul dan subtitle berdasarkan bahasa saat ini
    const titles = {
        'kritik': currentLang === 'id' ? 'Forum Kritik & Saran' : 'Critics Forum',
        'hardwareSoftware': currentLang === 'id' ? 'Forum IoT' : 'Hardware & Software Forum',
        'ai': currentLang === 'id' ? 'Forum Artificial Intelligence' : 'AI Forum',
        'web3': currentLang === 'id' ? 'Forum Web3 & Blockchain' : 'Web3 & Blockchain Forum',
        'teknologiUmum': currentLang === 'id' ? 'Cyber Securiy' : 'General Technology Forum',
        'fintech': currentLang === 'id' ? 'Forum Fintech' : 'Fintech Forum',
        'investasi': currentLang === 'id' ? 'Forum Investasi' : 'Investment Forum',
        'kripto': currentLang === 'id' ? 'Forum Kripto' : 'Crypto Forum',
        'perencanaan': currentLang === 'id' ? 'Forum Perencanaan Keuangan' : 'Financial Planning Forum',
        'bisnis': currentLang === 'id' ? 'Forum Bisnis' : 'Business Forum',
        'personalBranding': currentLang === 'id' ? 'Forum Personal Branding' : 'Personal Branding Forum',
        'marketing': currentLang === 'id' ? 'Forum Marketing' : 'Marketing Forum',
        'kebiasaanProduktif': currentLang === 'id' ? 'Forum Kebiasaan Produktif' : 'Productive Habits Forum',
        'toolsProduktivitas': currentLang === 'id' ? 'Forum Tools Produktivitas' : 'Productivity Tools Forum',
        'workLifeBalance': currentLang === 'id' ? 'Forum Work-Life Balance' : 'Work-Life Balance Forum',
        'inspirasi': currentLang === 'id' ? 'Forum Inspirasi' : 'Inspiration Forum',
        'communityProject': currentLang === 'id' ? 'Forum Community Project' : 'Community Project Forum'
    };
    const subtitles = {
        'kritik': currentLang === 'id' ? 'Bagi kami setiap masukan sangat berharga!' : 'Your feedback is very valuable to us!',
        'hardwareSoftware': currentLang === 'id' ? 'Sharing tentang Teknologi Internet of Things' : 'Discuss hardware and software issues.',
        'ai': currentLang === 'id' ? 'Teknologi cerdas dan pembelajaran mesin.' : 'Smart tech and machine learning.',
        'web3': currentLang === 'id' ? 'Desentralisasi dan blockchain.' : 'Decentralization and blockchain.',
        'teknologiUmum': currentLang === 'id' ? 'Topik seputar Keamanan Cyber dan Privasi.' : 'General topics about technology.',
        'fintech': currentLang === 'id' ? 'Inovasi finansial berbasis teknologi.' : 'Technology-driven financial innovation.',
        'investasi': currentLang === 'id' ? 'Strategi dan analisa investasi.' : 'Investment strategies and analysis.',
        'kripto': currentLang === 'id' ? 'Aset kripto dan ekosistemnya.' : 'Crypto assets and ecosystem.',
        'perencanaan': currentLang === 'id' ? 'Perencanaan keuangan pribadi dan bisnis.' : 'Personal and business financial planning.',
        'bisnis': currentLang === 'id' ? 'Diskusi pengembangan bisnis.' : 'Business development discussions.',
        'personalBranding': currentLang === 'id' ? 'Bangun citra diri profesional.' : 'Build your professional image.',
        'marketing': currentLang === 'id' ? 'Strategi pemasaran modern.' : 'Modern marketing strategies.',
        'kebiasaanProduktif': currentLang === 'id' ? 'Kebiasaan dan rutinitas produktif.' : 'Productive habits and routines.',
        'toolsProduktivitas': currentLang === 'id' ? 'Alat bantu untuk produktivitas.' : 'Productivity tools and tips.',
        'workLifeBalance': currentLang === 'id' ? 'Seimbang antara kerja dan hidup.' : 'Balance between work and life.',
        'inspirasi': currentLang === 'id' ? 'Berbagi inspirasi dan ide.' : 'Share inspiration and ideas.',
        'communityProject': currentLang === 'id' ? 'Kolaborasi proyek komunitas.' : 'Community project collaboration.'
    };

    // Pastikan elemen target ada sebelum mengaksesnya
    const titleEl = document.getElementById('categoryTitle');
    const subtitleEl = document.getElementById('categorySubtitle');
    if (titleEl) titleEl.textContent = titles[category];
    if (subtitleEl) subtitleEl.textContent = subtitles[category];

    // Perbarui tampilan form rating
    const ratingSection = document.getElementById('ratingSection');
    const topicFormContainer = document.getElementById('topicFormContainer');
    if (ratingSection) {
        if (category === 'kritik') {
            ratingSection.classList.remove('hidden');
            if (topicFormContainer) topicFormContainer.classList.add('hidden');
        } else {
            ratingSection.classList.add('hidden');
            if (topicFormContainer) topicFormContainer.classList.remove('hidden');
        }
    }

    attachCategoryListeners();
}
    
    // Fungsi untuk menangani login dengan Google
    function handleGoogleLogin() {
        console.log("Fungsi handleGoogleLogin dipanggil.");
        const provider = new firebase.auth.GoogleAuthProvider();
        // Tambahkan opsi untuk selalu meminta pemilihan akun
        provider.setCustomParameters({
            prompt: 'select_account'
        });
        auth.signInWithPopup(provider)
            .then((result) => {
                console.log("Login popup berhasil.", result);
                // Login berhasil
                const user = result.user;
                console.log("Login berhasil sebagai:", user.email);
                currentUserEmail = user.email; // Gunakan email dari objek user Firebase
                // Sembunyikan halaman login, tampilkan navbar dan konten forum
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('mainNav').classList.remove('hidden');
                document.getElementById('forumMain').classList.remove('hidden');
                // Mulai mendengarkan perubahan untuk kategori default
                switchCategory(currentCategory);
            })
            .catch((error) => {
                // Tangani error login
                console.error("Error login Google:", error);
                console.error("Kode Error:", error.code);
                console.error("Pesan Error:", error.message);
                alert("Login gagal: " + error.message); // Tampilkan pesan error kepada pengguna
            });
    }
    // Fungsi untuk mengganti bahasa
    function setLang(lang) {
    currentLang = lang;

    // Ambil tombol bahasa
    const btnId = document.getElementById('btnId');
    const btnEn = document.getElementById('btnEn');

    // Reset semua tombol bahasa
    btnId.classList.remove('bg-cyan-500/20', 'text-cyan-300', 'border', 'border-cyan-500/30');
    btnEn.classList.remove('bg-cyan-500/20', 'text-cyan-300', 'border', 'border-cyan-500/30');
    btnId.classList.add('text-gray-400');
    btnEn.classList.add('text-gray-400');

    // Tambahkan highlight ke tombol yang aktif
    if (lang === 'id') {
        btnId.classList.remove('text-gray-400');
        btnId.classList.add('bg-cyan-500/20', 'text-cyan-300', 'border', 'border-cyan-500/30');
    } else if (lang === 'en') {
        btnEn.classList.remove('text-gray-400');
        btnEn.classList.add('bg-cyan-500/20', 'text-cyan-300', 'border', 'border-cyan-500/30');
    }

    // Ganti teks dan placeholder sesuai bahasa
    if (lang === 'id') {
        document.getElementById('navHomeLink').textContent = 'Home';
        const lblTek = document.getElementById('menuTeknologiLabel');
        if (lblTek) lblTek.innerHTML = 'Teknologi <span class="text-xs">‚ñº</span>';
        const lblFin = document.getElementById('menuFinanceLabel');
        if (lblFin) lblFin.innerHTML = 'Finance <span class="text-xs">‚ñº</span>';
        const lblBrand = document.getElementById('menuBrandingLabel');
        if (lblBrand) lblBrand.innerHTML = 'Bisnis & Personal Branding <span class="text-xs">‚ñº</span>';
        const lblLife = document.getElementById('menuLifestyleLabel');
        if (lblLife) lblLife.innerHTML = 'Lifestyle Produktif <span class="text-xs">‚ñº</span>';
        const lblInsp = document.getElementById('menuInspirasiLabel');
        if (lblInsp) lblInsp.innerHTML = 'Inspirasi & Community Project <span class="text-xs">‚ñº</span>';
        document.getElementById('menuKritik').textContent = 'Kritik';
        document.getElementById('navForumLink').textContent = 'Spectrum.Ai';

        document.getElementById('categoryTitle').textContent = 'Forum Kritik & Saran';
        document.getElementById('categorySubtitle').textContent = 'Bagi kami setiap masukan sangat berharga!';
        document.getElementById('newTopicTitle').textContent = 'Tambahkan Topik Baru';
        document.getElementById('topicAuthorName').placeholder = 'Nama Anda (wajib)';
        document.getElementById('topicTitle').placeholder = 'Judul Topik';
        document.getElementById('topicContent').placeholder = 'Isi topik...';
        document.getElementById('ratingLabel').textContent = 'Beri Penilaian:';
        const ratingCaptionElId = document.getElementById('ratingCaption');
        if (ratingCaptionElId) ratingCaptionElId.placeholder = 'Tulis caption penilaian (opsional)';
    } else if (lang === 'en') {
        document.getElementById('navHomeLink').textContent = 'Home';
        const lblTekEn = document.getElementById('menuTeknologiLabel');
        if (lblTekEn) lblTekEn.innerHTML = 'Technology <span class="text-xs">‚ñº</span>';
        const lblFinEn = document.getElementById('menuFinanceLabel');
        if (lblFinEn) lblFinEn.innerHTML = 'Finance <span class="text-xs">‚ñº</span>';
        const lblBrandEn = document.getElementById('menuBrandingLabel');
        if (lblBrandEn) lblBrandEn.innerHTML = 'Business & Personal Branding <span class="text-xs">‚ñº</span>';
        const lblLifeEn = document.getElementById('menuLifestyleLabel');
        if (lblLifeEn) lblLifeEn.innerHTML = 'Productive Lifestyle <span class="text-xs">‚ñº</span>';
        const lblInspEn = document.getElementById('menuInspirasiLabel');
        if (lblInspEn) lblInspEn.innerHTML = 'Inspiration & Community Project <span class="text-xs">‚ñº</span>';
        document.getElementById('menuKritik').textContent = 'Critics';
        document.getElementById('navForumLink').textContent = 'Spectrum.Ai';

        document.getElementById('categoryTitle').textContent = 'Critics Forum';
        document.getElementById('categorySubtitle').textContent = 'Your feedback is very valuable to us!';
        document.getElementById('newTopicTitle').textContent = 'Add New Topic';
        document.getElementById('topicAuthorName').placeholder = 'Your Name (required)';
        document.getElementById('topicTitle').placeholder = 'Topic Title';
        document.getElementById('topicContent').placeholder = 'Topic Content...';
        document.getElementById('ratingLabel').textContent = 'Give Rating:';
        const ratingCaptionElEn = document.getElementById('ratingCaption');
        if (ratingCaptionElEn) ratingCaptionElEn.placeholder = 'Write rating caption (optional)';
    }

    // Panggil switchCategory untuk memperbarui judul halaman utama dan placeholder
    switchCategory(currentCategory);
}
    // Muat data login dari localStorage saat halaman dimuat
    window.addEventListener('DOMContentLoaded', (event) => {
        console.log("DOMContentLoaded event fired.");
        // Pasang event listener untuk tombol Google Login
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        if (googleLoginBtn) {
             console.log("Tombol Google Login ditemukan, menambahkan event listener.");
             googleLoginBtn.addEventListener('click', handleGoogleLogin);
        } else {
             console.error("Tombol Google Login (ID: googleLoginBtn) tidak ditemukan di DOM.");
        }
        // Cek status login saat halaman dimuat
        auth.onAuthStateChanged((user) => {
            console.log("onAuthStateChanged dipanggil. User:", user);
            if (user) {
                // Jika pengguna sudah login, tampilkan forum
                console.log("Pengguna sudah login, menampilkan forum.");
                currentUserEmail = user.email;
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('mainNav').classList.remove('hidden');
                document.getElementById('forumMain').classList.remove('hidden');
                switchCategory(currentCategory);
            } else {
                // Jika tidak, tetap tampilkan halaman login
                console.log("Pengguna belum login, menampilkan halaman login.");
                document.getElementById('loginPage').classList.remove('hidden');
                // Sembunyikan konten forum jika belum login
                document.getElementById('forumMain').classList.add('hidden');
            }
        });
    });
    // Ekspor fungsi ke window agar bisa dipanggil oleh onclick di HTML
    window.postReply = postReply;
    window.deleteComment = deleteComment;
    window.setLang = setLang; // Fungsi ini sekarang diperbarui
    window.switchCategory = switchCategory;
    window.createTopic = createTopic;
    window.deleteTopic = deleteTopic;
    window.likeTopic = likeTopic;
    window.likeComment = likeComment;
    window.toggleReplyForm = toggleReplyForm;
    window.toggleReplies = toggleReplies;
    window.postTopicReply = postTopicReply;
    window.toggleTopicReplyForm = toggleTopicReplyForm;
    window.toggleTopicReplies = toggleTopicReplies;
    window.deleteCommentReply = deleteCommentReply;
    window.deleteTopicReply = deleteTopicReply;
  </script>
    <style>
  /* Background Angkasa Gelap */
  body {
    background: #000;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #fff;
    position: relative;
  }
  /* Efek Neural Biru Mengambang */
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 30% 30%, rgba(0, 10, 40, 0.8) 0%, rgba(0, 0, 0, 1) 70%);
    z-index: -2;
  }
    /* Jaringan Neural - Titik-titik & Garis */
  .neural-network {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    overflow: hidden;
    pointer-events: none;
  }
  canvas {
    display: block;
    width: 100%;
    height: 100%;
  }
</style>
<div class="neural-network">
  <canvas id="neuralCanvas"></canvas>
</div>
<script>
  // ===== Efek Neural Network Biru =====
  const canvas = document.getElementById("neuralCanvas");
  const ctx = canvas.getContext("2d");
  let particles = [];
  const numParticles = 60;
  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();
  for (let i = 0; i < numParticles; i++) {
    particles.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      vx: (Math.random() - 0.5) * 0.6,
      vy: (Math.random() - 0.5) * 0.6,
    });
  }
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "rgba(0, 255, 255, 0.7)";
    particles.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
      ctx.fill();
    });
    for (let i = 0; i < numParticles; i++) {
      for (let j = i + 1; j < numParticles; j++) {
        const dx = particles[i].x - particles[j].x;
        const dy = particles[i].y - particles[j].y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < 120) {
          ctx.strokeStyle = `rgba(0, 255, 255, ${1 - dist / 120})`;
          ctx.lineWidth = 0.5;
          ctx.beginPath();
          ctx.moveTo(particles[i].x, particles[i].y);
          ctx.lineTo(particles[j].x, particles[j].y);
          ctx.stroke();
        }
      }
    }
    particles.forEach(p => {
      p.x += p.vx;
      p.y += p.vy;
      if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
      if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
    });
    requestAnimationFrame(draw);
  }
  draw();
</script>
<!-- Modal Konfirmasi Kustom -->
<div id="customConfirmModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[9999] hidden">
    <div class="bg-[rgba(13,20,35,0.8)] rounded-xl p-6 border border-cyan-500/30 max-w-md w-full mx-4 shadow-2xl animate-fade-in-up">
        <div class="text-center mb-4">
            <h3 class="text-lg font-bold text-transparent bg-gradient-to-r from-cyan-400 to-fuchsia-500 bg-clip-text">Konfirmasi Hapus</h3>
        </div>
        <p id="customConfirmMessage" class="text-gray-300 mb-6 text-sm">Apakah Anda yakin ingin menghapus komentar ini?</p>
        <div class="flex justify-end gap-3">
            <button id="customConfirmCancel" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium rounded-lg transition">
                Batal
            </button>
            <button id="customConfirmOK" class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white text-sm font-medium rounded-lg transition">
                Hapus
            </button>
        </div>
    </div>
</div>
<!-- Animasi CSS -->
<style>
    @keyframes fade-in-up {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    .animate-fade-in-up {
        animation: fade-in-up 0.3s ease-out forwards;
    }
    @keyframes fade-out-down {
        from {
            opacity: 1;
            transform: translateY(0);
        }
        to {
            opacity: 0;
            transform: translateY(20px);
        }
    }
    .animate-fade-out-down {
        animation: fade-out-down 0.3s ease-in forwards;
    }
    /* Gaya ringan untuk memperjelas balasan */
    .reply-card { border: 1px solid rgba(0,234,255,0.08); }
    .reply-toggle { transition: color .2s ease; }
</style>
</body>
</html>
