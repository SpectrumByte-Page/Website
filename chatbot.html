<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chatbot - SpectrumAI</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" type="image/png" href="img/ico.png" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { display: ['Inter', 'sans-serif'] },
          screens: { xs: '480px' }
        }
      }
    }
  </script>
  <style>
    body {
      background: linear-gradient(135deg, #0b1120 0%, #131e33 100%);
      color: white;
      min-height: 100vh;
      font-family: 'Inter', sans-serif;
    }
    .fade-in {
      animation: fadeIn 0.6s ease-out forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="font-sans">

  <!-- ===== NAVBAR ATAS ===== -->
  <nav class="fixed top-0 left-0 right-0 z-[9999] bg-black/80 backdrop-blur-sm border-b border-cyan-500/20 px-4 py-2 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <a href="index.html">
        <img src="img/Logo.png" alt="Spectrum.Byte" class="w-7 h-7 rounded-full border border-cyan-400 shadow-[0_0_8px_rgba(0,255,255,0.4)]">
      </a>
      <a href="index.html" class="text-base font-bold text-transparent bg-gradient-to-r from-cyan-400 to-fuchsia-500 bg-clip-text">Home</a>
    </div>
    <div class="flex items-center gap-2">
      <div class="flex items-center gap-1">
        <button onclick="setLang('id')" id="btnId" 
                class="px-2.5 py-1 text-xs font-medium rounded-md bg-cyan-500/20 text-cyan-300 border border-cyan-500/30">ID</button>
        <button onclick="setLang('en')" id="btnEn" 
                class="px-2.5 py-1 text-xs font-medium rounded-md text-gray-400 hover:text-gray-200">ENG</button>
      </div>
      <a href="Ai.html" 
         class="ml-2 bg-[rgba(0,234,255,0.15)] border border-[rgba(0,234,255,0.3)] text-white px-3 py-1.5 rounded-lg text-xs sm:text-sm transition uppercase tracking-wide no-underline flex items-center gap-1">
        Spectrum.AI
      </a>
      <a href="forum.html" 
         class="ml-2 bg-[rgba(0,234,255,0.15)] border border-[rgba(0,234,255,0.3)] text-white px-3 py-1.5 rounded-lg text-xs sm:text-sm transition uppercase tracking-wide no-underline flex items-center gap-1">
        FORUM
      </a>
    </div>
  </nav>

  <!-- ===== CHAT CONTAINER ===== -->
  <main class="pt-20 pb-24 px-4 max-w-2xl mx-auto">
    <div class="text-center mb-6">
      <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-fuchsia-500 text-transparent bg-clip-text">Spectrum.Ai</h1>
    </div>

    <!-- Chat Box -->
    <div id="chatbox" class="h-[60vh] max-h-[600px] overflow-y-auto bg-[rgba(10,18,30,0.7)] rounded-xl p-4 border border-cyan-500/20 mb-4 space-y-4">
      <div class="flex items-start gap-3">
        <div class="flex flex-col items-center">
          <span class="text-xs text-fuchsia-300 mb-1">Spectrum.AI</span>
          <img src="img/Logo.png" alt="SpectrumAI" class="w-8 h-8 rounded-full border border-fuchsia-400 shadow-[0_0_8px_rgba(255,0,255,0.3)]">
        </div>
        <div class="bg-[rgba(5,12,22,0.6)] p-3 rounded-lg max-w-[80%]">
          <p class="text-gray-200">Selamat datang di Spectrum.Aiüëãüèª. Saya adalah hasil dari sinergi antara pikiran manusiaüß† dan logika mesin‚öô.
             Setiap kata yang kamu tulis membuka percakapan antara realitas dan algoritma.üòé
          </p>
        </div>
      </div>
    </div>

    <!-- Input Form -->
    <form id="chatForm" class="flex gap-2">
      <input type="text" id="userInput" 
             class="flex-1 p-3 rounded-lg bg-gray-800 text-white border border-cyan-500/30 focus:outline-none focus:ring-1 focus:ring-cyan-400 placeholder-gray-400"
             placeholder="Ketik pesan Anda..." autocomplete="off">
      <button type="submit"
              class="px-4 py-3 bg-cyan-500 hover:bg-cyan-400 text-black font-medium rounded-lg transition whitespace-nowrap">
        Kirim
      </button>
    </form>
  </main>

  <script>
      const chatbox = document.getElementById('chatbox');
      const chatForm = document.getElementById('chatForm');
      const userInput = document.getElementById('userInput');

      function scrollToBottom() {
        chatbox.scrollTop = chatbox.scrollHeight;
      }

      function addMessage(text, isUser = false) {
        const div = document.createElement('div');
        div.className = 'flex items-start gap-3 ' + (isUser ? 'justify-end' : 'justify-start');

        const safeText = typeof text === 'object' ? JSON.stringify(text, null, 2) : text;

        if (isUser) {
          div.innerHTML = `
            <div class="bg-[rgba(0,234,255,0.2)] text-white p-3 rounded-lg max-w-[100%]">${safeText}</div>
            <div class="flex flex-col items-center">
              <span class="text-xs text-cyan-300 mb-1">User</span>
              <img src="img/Logo.png" alt="User" class="w-8 h-8 rounded-full border border-cyan-400 shadow-[0_0_8px_rgba(0,255,255,0.4)]">
            </div>
          `;
        } else {
          div.innerHTML = `
            <div class="flex flex-col items-center">
              <span class="text-xs text-fuchsia-300 mb-1">SpectrumAI</span>
              <img src="img/Logo.png" alt="SpectrumAI" class="w-8 h-8 rounded-full border border-fuchsia-400 shadow-[0_0_8px_rgba(255,0,255,0.3)]">
            </div>
            <div class="bg-[rgba(5,12,22,0.6)] text-gray-200 p-3 rounded-lg max-w-[80%]">${safeText}</div>
          `;
        }

        chatbox.appendChild(div);
        scrollToBottom();
      }

      // üöÄ Kirim pesan ke n8n webhook
      async function getAIResponse(userMsg) {
        try {
          const res = await fetch("http://localhost:5678/webhook/spectrumai", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: userMsg })
          });

          if (!res.ok) throw new Error("Gagal menghubungi server AI");

          const data = await res.json();

          // üß† Normalisasi format respon dari n8n
          if (typeof data === "string") return data;

          if (data.reply) return data.reply; // format umum
          if (data.output) return data.output; // alternatif
          if (data.response) return data.response; // fallback lain
          if (data.data && data.data.reply) return data.data.reply; // nested JSON
          if (Array.isArray(data) && data[0]?.reply) return data[0].reply; // format array seperti dari Function n8n
          if (data.choices?.[0]?.message?.content) return data.choices[0].message.content;

          // Jika semua gagal
          return "‚ö†Ô∏è Tidak ada respon yang valid dari server AI.";

        } catch (err) {
          console.error("‚ùå Error saat fetch ke n8n:", err);
          return "Maaf saya sedang di perbaiki";
        }
      }

      // üß† Saat user kirim pesan
      chatForm.addEventListener('submit', async function (e) {
        e.preventDefault();
        const msg = userInput.value.trim();
        if (!msg) return;

        addMessage(msg, true);
        userInput.value = '';

        const typing = document.createElement('div');
        typing.className = 'flex items-start gap-3 justify-start';
        typing.innerHTML = `
          <div class="flex flex-col items-center">
            <span class="text-xs text-fuchsia-300 mb-1">SpectrumAI</span>
            <img src="img/Logo.png" alt="SpectrumAI" class="w-8 h-8 rounded-full border border-fuchsia-400 shadow-[0_0_8px_rgba(255,0,255,0.3)]">
          </div>
          <div class="bg-[rgba(5,12,22,0.6)] text-gray-400 italic p-3 rounded-lg max-w-[80%]">Mengetik...</div>
        `;
        chatbox.appendChild(typing);
        scrollToBottom();

        const aiResponse = await getAIResponse(msg);
        typing.remove();
        addMessage(aiResponse);
      });

      window.addEventListener('load', scrollToBottom);
  </script>


  <style>
  /* Background Angkasa Gelap */
  body {
    background: #000;
    margin: 0;
    padding: 0;
    overflow: hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #fff;
    position: relative;
  }

  /* Efek Neural Biru Mengambang */
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 30% 30%, rgba(0, 10, 40, 0.8) 0%, rgba(0, 0, 0, 1) 70%);
    z-index: -2;
  }

    /* Jaringan Neural - Titik-titik & Garis */
  .neural-network {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    overflow: hidden;
    pointer-events: none;
  }

  canvas {
    display: block;
    width: 100%;
    height: 100%;
  }
</style>

<div class="neural-network">
  <canvas id="neuralCanvas"></canvas>
</div>

<script>
  // ===== Efek Neural Network Biru =====
  const canvas = document.getElementById("neuralCanvas");
  const ctx = canvas.getContext("2d");

  let particles = [];
  const numParticles = 60;

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();

  for (let i = 0; i < numParticles; i++) {
    particles.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      vx: (Math.random() - 0.5) * 0.6,
      vy: (Math.random() - 0.5) * 0.6,
    });
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "rgba(0, 255, 255, 0.7)";

    particles.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
      ctx.fill();
    });

    for (let i = 0; i < numParticles; i++) {
      for (let j = i + 1; j < numParticles; j++) {
        const dx = particles[i].x - particles[j].x;
        const dy = particles[i].y - particles[j].y;
        const dist = Math.sqrt(dx * dx + dy * dy);

        if (dist < 120) {
          ctx.strokeStyle = `rgba(0, 255, 255, ${1 - dist / 120})`;
          ctx.lineWidth = 0.5;
          ctx.beginPath();
          ctx.moveTo(particles[i].x, particles[i].y);
          ctx.lineTo(particles[j].x, particles[j].y);
          ctx.stroke();
        }
      }
    }

    particles.forEach(p => {
      p.x += p.vx;
      p.y += p.vy;

      if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
      if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
    });

    requestAnimationFrame(draw);
  }

  draw();
</script>
</body>
</html>
